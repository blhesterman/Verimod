Version 4
SHEET 1 2652 1328
WIRE 0 -112 -112 -112
WIRE 192 -112 0 -112
WIRE 528 -112 192 -112
WIRE 656 -112 576 -112
WIRE 768 -112 720 -112
WIRE 880 -112 768 -112
WIRE -112 -96 -112 -112
WIRE 528 -96 528 -112
WIRE 576 -96 576 -112
WIRE 768 -96 768 -112
WIRE 880 -96 880 -112
WIRE 0 -80 0 -112
WIRE 1360 -48 1168 -48
WIRE 1360 -16 1280 -16
WIRE -112 0 -112 -16
WIRE 576 0 576 -16
WIRE 768 0 768 -32
WIRE 880 0 880 -16
WIRE 1616 0 1616 -48
WIRE 1616 0 1536 0
WIRE 1360 16 1296 16
WIRE 192 32 192 -112
WIRE 1296 64 1296 16
WIRE -144 96 -160 96
WIRE 0 96 0 0
WIRE 0 96 -64 96
WIRE 32 96 0 96
WIRE 384 96 352 96
WIRE 672 96 464 96
WIRE 800 96 752 96
WIRE 528 144 528 -16
WIRE 592 144 528 144
WIRE 800 144 800 96
WIRE 800 144 592 144
WIRE 1168 144 1168 -48
WIRE 1168 144 800 144
WIRE -96 176 -160 176
WIRE 32 176 -16 176
WIRE 368 176 352 176
WIRE 464 176 448 176
WIRE 528 176 528 144
WIRE -144 256 -160 256
WIRE -48 256 -64 256
WIRE 32 256 16 256
WIRE 416 256 352 256
WIRE 480 256 416 256
WIRE 1488 256 1424 256
WIRE 1616 256 1616 0
WIRE 1616 256 1568 256
WIRE 416 304 416 256
WIRE 656 304 416 304
WIRE 1296 304 1296 64
WIRE 1296 304 720 304
WIRE -48 336 -64 336
WIRE 32 336 16 336
WIRE 528 336 528 272
WIRE 528 336 352 336
WIRE 528 352 528 336
WIRE 128 416 128 400
WIRE 256 416 256 400
WIRE 528 448 528 432
WIRE 256 496 256 480
WIRE -1280 608 -1296 608
WIRE -1184 608 -1200 608
WIRE -1280 784 -1296 784
WIRE -1184 784 -1200 784
WIRE -1280 976 -1296 976
WIRE -1184 976 -1200 976
WIRE -1280 1168 -1296 1168
WIRE -1184 1168 -1200 1168
FLAG -64 336 0
FLAG -160 256 0
FLAG -160 176 0
FLAG -112 0 0
FLAG 256 496 0
FLAG 464 176 0
FLAG 768 0 0
FLAG 576 0 0
FLAG 880 0 0
FLAG -112 -112 IN
FLAG 880 -112 OUT
FLAG -160 96 0
FLAG 128 416 0
FLAG 528 448 0
FLAG -1296 784 0
FLAG -1184 784 aim
FLAG -1296 608 0
FLAG -1184 608 are
FLAG -1296 1168 0
FLAG -1184 1168 bim
FLAG -1296 976 0
FLAG -1184 976 bre
FLAG 1616 -48 B
IOPIN 1616 -48 In
FLAG 1424 256 A
IOPIN 1424 256 In
FLAG 592 144 Drain
FLAG 1280 -16 In
IOPIN 1280 -16 In
FLAG 1296 64 CLK
SYMBOL res 0 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 56.2K
SYMBOL voltage -112 -112 R0
SYMATTR InstName V1
SYMATTR Value 48
SYMBOL cap 16 240 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 4.7n
SYMBOL cap 240 480 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C2
SYMATTR Value 4.7µ
SYMBOL res 480 80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 243K
SYMBOL res 352 192 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value 6.04K
SYMBOL ind2 512 -112 R0
WINDOW 0 0 40 Right 2
WINDOW 3 0 72 Right 2
SYMATTR InstName L1
SYMATTR Value 60.8µ
SYMATTR Type ind
SYMATTR SpiceLine Rpar=5K
SYMBOL ind2 592 0 R180
WINDOW 0 3 79 Right 2
WINDOW 3 1 44 Right 2
SYMATTR InstName L2
SYMATTR Value 3.8µ
SYMATTR Type ind
SYMATTR SpiceLine Rpar=5K
SYMBOL cap 752 -96 R0
SYMATTR InstName C3
SYMATTR Value 100µ
SYMBOL schottky 656 -96 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value 30BQ060
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res -48 240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 10K
SYMBOL cap 16 352 M270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName C4
SYMATTR Value 2n
SYMBOL res -16 -96 R0
SYMATTR InstName R5
SYMATTR Value 412K
SYMBOL res -48 80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 15.4K
SYMBOL PowerProducts\\LT3748 192 208 R0
SYMATTR InstName U1
SYMBOL nmos 480 176 R0
SYMATTR InstName Q1
SYMATTR Value Si4490DY
SYMBOL res 512 336 R0
SYMATTR InstName R7
SYMATTR Value 33m
SYMBOL res 864 -112 R0
SYMATTR InstName Rload
SYMATTR Value 6
SYMBOL bi -1280 784 R270
WINDOW 0 42 71 VRight 2
WINDOW 3 92 -32 VRight 2
WINDOW 123 69 -32 VRight 2
WINDOW 39 47 -32 VRight 2
SYMATTR InstName B1
SYMATTR Value I=(sdt((u(time-t0)-u(time-te))*v(a)*(-1)*sin(2*pi*Freq*time)))
SYMATTR Value2 Rpar={Freq}
SYMATTR SpiceLine nojacob
SYMBOL bi -1280 608 R270
WINDOW 0 35 72 VRight 2
WINDOW 3 100 -32 VRight 2
WINDOW 123 74 -32 VRight 2
WINDOW 39 48 -31 VRight 2
SYMATTR InstName B2
SYMATTR Value I=(sdt((u(time-t0)-u(time-te))*v(a)*cos(2*pi*Freq*time)))
SYMATTR Value2 Rpar={Freq}
SYMATTR SpiceLine nojacob
SYMBOL bi -1280 1168 R270
WINDOW 0 36 72 VRight 2
WINDOW 3 93 -33 VRight 2
WINDOW 123 68 -33 VRight 2
WINDOW 39 46 -32 VRight 2
SYMATTR InstName B3
SYMATTR Value I=(sdt((u(time-t0)-u(time-te))*v(b)*(-1)*sin(2*pi*Freq*time)))
SYMATTR Value2 Rpar={Freq}
SYMATTR SpiceLine nojacob
SYMBOL bi -1280 976 R270
WINDOW 0 34 68 VRight 2
WINDOW 3 95 -32 VRight 2
WINDOW 123 69 -33 VRight 2
WINDOW 39 47 -32 VRight 2
SYMATTR InstName B4
SYMATTR Value I=(sdt((u(time-t0)-u(time-te))*v(b)*cos(2*pi*Freq*time)))
SYMATTR Value2 Rpar={Freq}
SYMATTR SpiceLine nojacob
SYMBOL voltage 656 96 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 74 258 VBottom 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value SINE(0 {vm} {Freq} 0 0 {Phi})
SYMBOL voltage 1472 256 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -84 62 VBottom 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value SINE(0 {vm} {Freq} 0 0 {Phi})
SYMBOL SpecialFunctions\\sample 1440 -16 R0
WINDOW 3 0 0 Invisible 0
SYMATTR Value Vhigh=100
SYMATTR InstName A1
SYMATTR Value2 Vlow=0
SYMBOL Digital\\inv 656 240 R0
WINDOW 3 -10 114 Left 2
SYMATTR Value TD = 300n
SYMATTR InstName A2
TEXT 552 -112 Bottom 2 !K1 L1 L2 1
TEXT 1456 896 Left 2 !.param t0=2m
TEXT 352 600 Left 2 !.meas lgmag PARAM 20*log10((hypot(v(bim),v(bre)))/(hypot(v(aim),v(are))))
TEXT 1448 648 Left 2 !.param te=t0+cycles/Freq
TEXT 1448 600 Left 2 !.param Phi=(1-Freq*t0)*360
TEXT 1448 696 Left 2 !.param cycles=5
TEXT 928 -120 Left 2 !.ic v(Out)=12
TEXT 1440 752 Left 2 !.param vm=1
TEXT 1456 832 Left 2 !.param Freq=1000
TEXT 1104 -96 Left 2 ;12.218V
TEXT 1448 1040 Left 2 !.tran 0 {te} {te-10n}
TEXT 1456 968 Left 2 !.step dec param Freq 100 10k 10
TEXT 352 656 Left 2 !.meas lgphipre1 PARAM ((atan2(v(bim),v(bre)))-(atan2(v(aim),v(are))))
TEXT 352 696 Left 2 !.meas lgphipre2 PARAM if(lgphipre1<-180,lgphipre1+360,lgphipre1)
TEXT 352 736 Left 2 !.meas lgphi PARAM if(lgphipre2>180,lgphipre1-360,lgphipre2)
